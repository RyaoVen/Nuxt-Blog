<script setup lang="ts">
import { ref, computed } from 'vue';
import { ElMessage } from 'element-plus';
import MomentsStore from '~/stores/moments';
import type { Moment } from '~/stores/type/moments';

// åŠ¨æ€/ç¬é—´ æ¨¡æ‹Ÿæ•°æ®
const moments = ref<Moment[]>([
  {
    id: 1,
    author: {
      name: "RyaoVen",
      avatar: "/avatars/ryaoven.jpg"
    },
    content: "åˆšå®Œæˆäº†åšå®¢çš„é‡æ„ï¼Œé‡‡ç”¨äº† Nuxt 3 + Element Plusï¼Œæ•´ä½“ä½“éªŒæå‡äº†ä¸å°‘ã€‚ç°ä»£åŒ–çš„è®¾è®¡é£æ ¼è®©äººçœ¼å‰ä¸€äº®ï¼âœ¨",
    images: ["/images/blog-refactor-1.jpg", "/images/blog-refactor-2.jpg"],
    date: "2024-11-16 18:30",
    likes: 28,
    comments: [
      {
        id: 1,
        author: {
          name: "å‰ç«¯å°æ«",
          avatar: "/avatars/feng.jpg"
        },
        content: "Nuxt 3 çš„æ€§èƒ½ç¡®å®æ¯” 2 æå‡å¾ˆå¤šï¼Œæˆ‘ä¹Ÿåˆšé‡æ„å®Œä¸ªäººåšå®¢ï¼Œä¸€èµ·äº¤æµä¸‹ï½",
        images: [],
        date: "2024-11-16 19:05",
        likes: 8
      },
      {
        id: 2,
        author: {
          name: "UIè®¾è®¡å¸ˆé˜¿ç³",
          avatar: "/avatars/lin.jpg"
        },
        content: "ç°ä»£åŒ–è®¾è®¡é£æ ¼æ±‚å‚è€ƒï¼æœ€è¿‘ä¹Ÿåœ¨åšåšå®¢è§†è§‰å‡çº§ ğŸ˜Š",
        images: [],
        date: "2024-11-16 20:12",
        likes: 5
      }
    ],
    type: "text"
  },
  {
    id: 2,
    author: {
      name: "RyaoVen",
      avatar: "/avatars/ryaoven.jpg"
    },
    content: "ä»Šå¤©å­¦ä¹ äº† Vue 3 çš„ Composition APIï¼Œæ„Ÿè§‰æ‰“å¼€äº†æ–°ä¸–ç•Œçš„å¤§é—¨ã€‚ä»£ç ç»„ç»‡æ›´åŠ çµæ´»äº†ï¼Œé€»è¾‘å¤ç”¨ä¹Ÿå˜å¾—ç®€å•ã€‚åˆ†äº«ä¸€ä¸‹å­¦ä¹ ç¬”è®° ğŸ“",
    images: [],
    link: {
      title: "æ·±å…¥ç†è§£ Vue 3 Composition API",
      url: "/passages/1",
      cover: "/images/vue3-notes-cover.jpg"
    },
    date: "2024-11-15 14:20",
    likes: 45,
    comments: [
      {
        id: 1,
        author: {
          name: "èœé¸Ÿå­¦å‰ç«¯",
          avatar: "/avatars/cainiao.jpg"
        },
        content: "Composition API ç¡®å®æ¯” Options API æ›´çµæ´»ï¼Œå°±æ˜¯åˆšå¼€å§‹ä¸Šæ‰‹æœ‰ç‚¹ç»•",
        images: [],
        date: "2024-11-15 15:01",
        likes: 12
      },
      {
        id: 2,
        author: {
          name: "å…¨æ ˆè€æ¨",
          avatar: "/avatars/yang.jpg"
        },
        content: "ç¬”è®°èƒ½å‘å‡ºæ¥çœ‹çœ‹å—ï¼Ÿæœ€è¿‘ä¹Ÿåœ¨ç³»ç»Ÿå­¦ Vue 3",
        images: [],
        date: "2024-11-15 16:40",
        likes: 7
      }
    ],
    type: "link"
  },
  {
    id: 3,
    author: {
      name: "RyaoVen",
      avatar: "/avatars/ryaoven.jpg"
    },
    content: "å‘¨æœ«å»äº†è¶ŸéƒŠå¤–ï¼Œé£æ™¯çœŸä¸é”™ã€‚å·¥ä½œä¹‹ä½™ä¹Ÿè¦è®°å¾—æ”¾æ¾è‡ªå·± ğŸŒ²ğŸŒ¤ï¸",
    images: ["/images/outdoor-1.jpg", "/images/outdoor-2.jpg"],
    date: "2024-11-14 10:15",
    likes: 67,
    comments: [
      {
        id: 1,
        author: {
          name: "æ—…è¡Œçˆ±å¥½è€…",
          avatar: "/avatars/travel.jpg"
        },
        content: "è¿™æ˜¯å“ªé‡Œå‘€ï¼Ÿé£æ™¯ä¹Ÿå¤ªå¥½äº†ï¼Œæ±‚å®šä½ï½",
        images: [],
        date: "2024-11-14 11:30",
        likes: 15
      },
      {
        id: 2,
        author: {
          name: "æ‰“å·¥äººå°å‘¨",
          avatar: "/avatars/zhou.jpg"
        },
        content: "ç¾¡æ…•äº†ï¼Œå¤©å¤©åŠ ç­æ ¹æœ¬æ²¡æ—¶é—´å‡ºé—¨ ğŸ˜­",
        images: [],
        date: "2024-11-14 13:25",
        likes: 9
      }
    ],
    type: "text"
  },
  {
    id: 4,
    author: {
      name: "RyaoVen",
      avatar: "/avatars/ryaoven.jpg"
    },
    content: "åˆ†äº«ä¸€ä¸ªå¾ˆæ£’çš„ CSS æŠ€å·§ï¼Œä½¿ç”¨ backdrop-filter å¯ä»¥å®ç°æ¯›ç»ç’ƒæ•ˆæœï¼Œè®©ç•Œé¢æ›´æœ‰å±‚æ¬¡æ„Ÿã€‚ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒäº†ï¼",
    images: ["/images/backdrop-filter-demo.jpg"],
    date: "2024-11-13 16:45",
    likes: 52,
    comments: [
      {
        id: 1,
        author: {
          name: "CSSçˆ±å¥½è€…",
          avatar: "/avatars/css.jpg"
        },
        content: "è¯•äº†ä¸‹çœŸçš„å¥½ç”¨ï¼ä¸è¿‡ä½ç‰ˆæœ¬ Safari å¥½åƒè¿˜æœ‰ç‚¹å…¼å®¹é—®é¢˜",
        images: [],
        date: "2024-11-13 17:20",
        likes: 11
      },
      {
        id: 2,
        author: {
          name: "å‰ç«¯åˆ‡å›¾ä»”",
          avatar: "/avatars/cutter.jpg"
        },
        content: "æ”¶è—äº†ï¼æ­£å¥½æ–°é¡¹ç›®è¦åšæ¯›ç»ç’ƒæ•ˆæœï¼Œå¤ªåŠæ—¶äº†",
        images: [],
        date: "2024-11-13 18:05",
        likes: 6
      }
    ],
    type: "text"
  },
  {
    id: 5,
    author: {
      name: "RyaoVen",
      avatar: "/avatars/ryaoven.jpg"
    },
    content: "å‡Œæ™¨ä¿®å¤äº†ä¸€ä¸ªå›°æ‰°å¾ˆä¹…çš„ bugï¼ŒåŸæ¥æ˜¯å¼‚æ­¥å¤„ç†çš„é—®é¢˜ã€‚debug çš„è¿‡ç¨‹è™½ç„¶ç—›è‹¦ï¼Œä½†è§£å†³åçš„æˆå°±æ„Ÿæ— ä¸ä¼¦æ¯” ğŸ’ª",
    images: [],
    date: "2024-11-12 02:30",
    likes: 38,
    comments: [
      {
        id: 1,
        author: {
          name: "ç¨‹åºçŒ¿é˜¿æ°",
          avatar: "/avatars/jie.jpg"
        },
        content: "æ‡‚è¿™ç§æ„Ÿè§‰ï¼ä¸Šæ¬¡æ”¹ bug æ”¹åˆ°å‡Œæ™¨ 4 ç‚¹ï¼Œè§£å†³åç›´æ¥ç²¾ç¥äº†",
        images: [],
        date: "2024-11-12 09:10",
        likes: 8
      },
      {
        id: 2,
        author: {
          name: "æµ‹è¯•å°å§å§",
          avatar: "/avatars/test.jpg"
        },
        content: "è¾›è‹¦å•¦ï¼è¿˜å¥½è§£å†³äº†ï¼Œä¸ç„¶åˆè¦æbugäº†å“ˆå“ˆ",
        images: [],
        date: "2024-11-12 10:20",
        likes: 4
      }
    ],
    type: "text"
  },
  {
    id: 6,
    author: {
      name: "RyaoVen",
      avatar: "/avatars/ryaoven.jpg"
    },
    content: "æœ€è¿‘åœ¨ç ”ç©¶å¾®å‰ç«¯æ¶æ„ï¼Œqiankun æ¡†æ¶ç¡®å®å¾ˆå¼ºå¤§ã€‚å¤§å‹é¡¹ç›®çš„æ¨¡å—åŒ–ç®¡ç†æœ‰äº†æ–°çš„æ€è·¯ã€‚",
    images: [],
    date: "2024-11-11 11:20",
    likes: 41,
    comments: [
      {
        id: 1,
        author: {
          name: "æ¶æ„å¸ˆè€é™ˆ",
          avatar: "/avatars/chen.jpg"
        },
        content: "qiankun ç¡®å®æˆç†Ÿï¼Œä¸è¿‡ä¹Ÿè¦æ³¨æ„åº”ç”¨é—´çš„é€šä¿¡å’Œæ ·å¼éš”ç¦»é—®é¢˜",
        images: [],
        date: "2024-11-11 12:15",
        likes: 10
      },
      {
        id: 2,
        author: {
          name: "å‰ç«¯è¿›é˜¶ä¸­",
          avatar: "/avatars/advance.jpg"
        },
        content: "æ±‚åˆ†äº«å­¦ä¹ èµ„æ–™ï¼å…¬å¸å‡†å¤‡åšå¾®å‰ç«¯ï¼Œæ­£åœ¨é€‰å‹",
        images: [],
        date: "2024-11-11 14:30",
        likes: 7
      }
    ],
    type: "text"
  },
  {
    id: 7,
    author: {
      name: "RyaoVen",
      avatar: "/avatar.jpg"
    },
    content: "ä»Šå¤©çš„å’–å•¡ç‰¹åˆ«é¦™ â˜•ï¼Œç»§ç»­å†™ä»£ç ï¼",
    images: ["/images/coffee.jpg"],
    date: "2024-11-10 09:00",
    likes: 89,
    comments: [
      {
        id: 1,
        author: {
          name: "å’–å•¡æ§",
          avatar: "/avatars/coffee.jpg"
        },
        content: "åŒæ¬¾å’–å•¡è±†ï¼å–äº†å’–å•¡å†™ä»£ç æ•ˆç‡ç¿»å€ â˜•",
        images: [],
        date: "2024-11-10 09:25",
        likes: 20
      },
      {
        id: 2,
        author: {
          name: "æ—©èµ·å›°éš¾æˆ·",
          avatar: "/avatars/lazy.jpg"
        },
        content: "ç¾¡æ…•èƒ½æ—©èµ·çš„äººï¼Œæˆ‘éƒ½æ˜¯é å’–å•¡ç»­å‘½åˆ°ä¸­åˆ ğŸ˜‚",
        images: [],
        date: "2024-11-10 10:10",
        likes: 12
      }
    ],
    type: "text"
  },
  {
    id: 8,
    author: {
      name: "RyaoVen",
      avatar: "/avatars/ryaoven.jpg"
    },
    content: "TypeScript 5.0 å‘å¸ƒäº†ï¼Œæ–°ç‰¹æ€§å€¼å¾—å…³æ³¨ã€‚ç±»å‹ç³»ç»Ÿè¶Šæ¥è¶Šå¼ºå¤§ï¼Œå¼€å‘ä½“éªŒä¹Ÿåœ¨ä¸æ–­æå‡ã€‚",
    images: [],
    date: "2024-11-09 15:30",
    likes: 56,
    comments: [
      {
        id: 1,
        author: {
          name: "TSçˆ±å¥½è€…",
          avatar: "/avatars/ts.jpg"
        },
        content: "5.0 çš„è£…é¥°å™¨ç»ˆäºç¨³å®šäº†ï¼Œä¸ç”¨å†ç”¨ experimental æ¨¡å¼äº†",
        images: [],
        date: "2024-11-09 16:05",
        likes: 9
      },
      {
        id: 2,
        author: {
          name: "åç«¯è½¬å‰ç«¯",
          avatar: "/avatars/backend.jpg"
        },
        content: "ä¸€ç›´ä¸æ•¢å­¦TSï¼Œç°åœ¨æ˜¯ä¸æ˜¯è¯¥å…¥å‘äº†ï¼Ÿ",
        images: [],
        date: "2024-11-09 17:10",
        likes: 5
      }
    ],
    type: "text"
  }
]);

const momentsStore = MomentsStore();

// ç»Ÿè®¡æ•°æ®
const totalMoments = computed(() => moments.value.length);
const totalLikes = computed(() => moments.value.reduce((sum, m) => sum + m.likes, 0));
const totalComments = computed(() => moments.value.reduce((sum, m) => sum + m.comments.length, 0));

// ç‚¹èµåŠ¨æ€
const likeMoment = (moment: Moment) => {
  moment.likes++;
};

const submitComment = (momentId: number, content: string) => {
  const moment = moments.value.find(m => m.id === momentId);
  if (moment) {
    moment.comments.unshift({
      id: Date.now(),
      author: {
        name: "æˆ‘",
        avatar: "/Avatar.jpg"
      },
      content: content,
      images: [],
      date: "åˆšåˆš",
      likes: 0
    });
    ElMessage.success('è¯„è®ºå‘è¡¨æˆåŠŸ');
  }
};
</script>

<template>
  <div :class="$style.body">
    <div :class="$style.layout">
      <!-- å·¦ä¾§ä¸ªäººä¿¡æ¯å¡ç‰‡ -->
      <aside :class="$style.sidebar">
        <MomentsProfileCard
          :totalMoments="totalMoments"
          :totalLikes="totalLikes"
          :totalComments="totalComments"
        />
        <MomentsInfoCard />
      </aside>

      <!-- ä¸»å†…å®¹åŒº -->
      <main :class="$style.mainContent">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div :class="$style.pageHeader">
          <h1 :class="$style.pageTitle">é—²è¯</h1>
          <p :class="$style.pageDesc">è®°å½•ç”Ÿæ´»ç‚¹æ»´ï¼Œåˆ†äº«æŠ€æœ¯å¿ƒå¾—</p>
        </div>

        <!-- åŠ¨æ€åˆ—è¡¨ -->
        <MomentsList
          :moments="moments"
          @like="likeMoment"
          @submitComment="submitComment"
        />
      </main>
    </div>
  </div>
</template>

<style module>
.body {
  min-height: 100vh;
  background: linear-gradient(to bottom, var(--el-bg-color) 0%, var(--el-bg-color-page) 100%);
  padding: 80px 20px 60px;
  transition: background 0.3s ease;
}

.layout {
  max-width: 1200px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 32px;
}

/* ä¾§è¾¹æ  */
.sidebar {
  display: flex;
  flex-direction: column;
  gap: 24px;
  position: sticky;
  top: 100px;
  height: fit-content;
}

/* ä¸»å†…å®¹åŒº */
.mainContent {
  min-width: 0;
}

.pageHeader {
  margin-bottom: 32px;
}

.pageTitle {
  font-size: 36px;
  font-weight: 700;
  color: var(--el-text-color-primary);
  margin: 0 0 8px 0;
  letter-spacing: -0.5px;
}

.pageDesc {
  font-size: 16px;
  color: var(--el-text-color-regular);
  margin: 0;
}

@media (max-width: 1024px) {
  .layout {
    grid-template-columns: 240px 1fr;
    gap: 24px;
  }
}

@media (max-width: 768px) {
  .body {
    padding: 60px 16px 40px;
  }

  .layout {
    grid-template-columns: 1fr;
  }

  .sidebar {
    position: static;
  }

  .pageTitle {
    font-size: 28px;
  }
}
</style>
